<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retirement Planner - Better Investor</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PRYY0KZ7HK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-PRYY0KZ7HK', {
            'send_page_view': true,
            'allow_enhanced_conversions': false,
            'allow_google_signals': false
        });
        
        // D√©sactiver les √©v√©nements automatiques non d√©sir√©s
        gtag('set', 'allow_ad_personalization_signals', false);
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
    #planner-app { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #fcfdfe; color: #1e293b; padding-bottom: 80px; }
    
    .copyright-banner { background-color: #f8fafc; border-bottom: 1px solid #e2e8f0; padding: 10px 0; text-align: center; font-size: 12px; color: #64748b; font-weight: 500; }
    
    .input-box { border: 2px solid #e2e8f0 !important; border-radius: 16px !important; padding: 14px 18px !important; width: 100% !important; background: #ffffff !important; outline: none !important; font-weight: 600; transition: all 0.2s; }
    .input-box:focus { border-color: #6366f1 !important; box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1) !important; }
    
    .setup-card { background: white !important; border-radius: 40px !important; border: 1px solid #f1f5f9 !important; padding: 48px !important; max-width: 950px; margin: 0 auto; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.04); }
    
    .btn-giant { background-color: #6366f1 !important; color: white !important; font-weight: 800 !important; font-size: 1.1rem !important; padding: 22px !important; border-radius: 22px !important; width: 100% !important; text-transform: uppercase !important; cursor: pointer; border: none; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 12px; min-height: 80px; }

    .label-style { display: block; font-size: 11px; font-weight: 800; color: #6366f1; text-transform: uppercase; letter-spacing: 0.15em; margin-bottom: 10px; }

    /* FLOU Lead Magnet */
    .preview-blur { filter: blur(14px); pointer-events: none; user-select: none; opacity: 0.45; transition: all 0.6s ease; }
    
    .spinner { width: 22px; height: 22px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #fff; animation: spin 0.8s linear infinite; display: none; }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(10px); } }
    
    .chart-section { position: relative; height: 450px; border-radius: 40px; background: #ffffff; padding: 20px; border: 1px solid #f1f5f9; }
    
    /* Footer Styles */
    .site-footer { background: #fcfdfe; color: #475569; padding: 30px 20px 20px; margin-top: 60px; border-top: 1px solid #e2e8f0; }
    .footer-content { max-width: 1200px; margin: 0 auto; }
    .footer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; margin-bottom: 20px; }
    .footer-section h3 { color: #1e293b; font-weight: 700; font-size: 0.95rem; margin-bottom: 10px; }
    .footer-section ul { list-style: none; padding: 0; margin: 0; }
    .footer-section ul li { margin-bottom: 6px; }
    .footer-section a { color: #64748b; text-decoration: none; transition: color 0.2s; font-size: 0.9rem; }
    .footer-section a:hover { color: #6366f1; }
    .footer-bottom { border-top: 1px solid #e2e8f0; padding-top: 15px; text-align: center; color: #94a3b8; font-size: 0.85rem; }
    
    /* Mobile Responsive */
    @media (max-width: 768px) {
        #planner-app { padding-bottom: 40px; }
        .copyright-banner { font-size: 13px; padding: 12px 15px; }
        .setup-card { padding: 32px 24px !important; border-radius: 28px !important; }
        .btn-giant { font-size: 1.1rem !important; padding: 20px !important; min-height: 70px; }
        .label-style { font-size: 12px; margin-bottom: 8px; }
        .input-box { padding: 16px 18px !important; font-size: 18px !important; border-radius: 14px !important; }
        .chart-section { height: 350px; padding: 20px; border-radius: 24px; }
        .site-footer { padding: 25px 20px 20px; margin-top: 50px; }
        .footer-grid { grid-template-columns: 1fr; gap: 25px; text-align: center; }
        .footer-section { margin-bottom: 20px; }
        .footer-section h3 { font-size: 1.1rem; }
        .footer-section a { font-size: 1rem; }
        .footer-bottom { font-size: 0.9rem; }
        header h1 { font-size: 3rem !important; line-height: 1.1; }
        header img { max-width: 250px !important; margin: 20px auto 0 !important; }
        .max-w-6xl { padding-left: 20px !important; padding-right: 20px !important; }
        .grid.gap-12 { gap: 2rem !important; }
        section h2 { font-size: 1.75rem !important; margin-bottom: 2rem !important; }
    }
    
    @media (max-width: 480px) {
        .setup-card { padding: 28px 20px !important; }
        .btn-giant { font-size: 1rem !important; padding: 18px !important; min-height: 65px; }
        header h1 { font-size: 2.5rem !important; }
        header img { max-width: 200px !important; }
        .chart-section { height: 300px; }
        .label-style { font-size: 11px; }
        .input-box { padding: 15px 16px !important; font-size: 17px !important; }
        section h2 { font-size: 1.5rem !important; margin-bottom: 1.5rem !important; }
    }
</style>

<div id="planner-app">
    <div class="copyright-banner">
        This tool is made by <b>Tom - Lazy Investor</b> and is copyright protected &copy; 2026
    </div>

    <div class="max-w-6xl mx-auto py-12 px-4 text-center">
        <header class="mb-16">
            <h1 class="text-5xl md:text-6xl font-black text-slate-900 tracking-tight">Retirement Planner</h1>
            <img src="/hero-image.png" alt="Engineer your exit from the 9-to-5" style="max-width: 300px; margin: 20px auto 0; display: block; border-radius: 12px;">
        </header>

        <section id="inputSection" class="setup-card text-left">
            <h2 class="text-3xl md:text-4xl font-black text-slate-900 text-center mb-12">
                Calculate Your Freedom Number
                <div style="display: flex; justify-content: center; gap: 8px; margin-top: 12px;">
                    <span style="color: #6366f1; font-size: 1.5rem; animation: bounce 2s infinite;">‚Üì</span>
                    <span style="color: #6366f1; font-size: 1.5rem; animation: bounce 2s infinite 0.2s;">‚Üì</span>
                    <span style="color: #6366f1; font-size: 1.5rem; animation: bounce 2s infinite 0.4s;">‚Üì</span>
                </div>
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-12 mb-10">
                <div class="space-y-8">
                    <h3 class="label-style">Step 1: Your Timeline</h3>
                    <div class="grid grid-cols-2 gap-6">
                        <div><label class="label-style text-slate-300">Current Age</label><input type="number" id="currentAge" class="input-box" value="30"></div>
                        <div><label class="label-style text-slate-300">Duration (Years)</label><input type="number" id="duration" class="input-box" value="20"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-6">
                        <div><label class="label-style text-slate-300">Return (%)</label><input type="number" id="returnRate" class="input-box" value="8"></div>
                        <div><label class="label-style text-slate-300">Inflation (%)</label><input type="number" id="inflationRate" class="input-box" value="3"></div>
                    </div>
                </div>
                <div class="space-y-8">
                    <h3 class="label-style">Step 2: Strategy</h3>
                    <div><label class="label-style text-slate-300">Initial Capital ($)</label><input type="number" id="initialCapital" class="input-box" value="50000"></div>
                    <div><label class="label-style text-slate-300">Annual Addition ($)</label><input type="number" id="annualAddition" class="input-box" value="15000"></div>
                </div>
            </div>
            
            <button id="mainBtn" onclick="startLoading()" class="btn-giant">
                <div id="btnSpinner" class="spinner"></div>
                <span id="btnText">Generate My Retirement Path</span>
            </button>
        </section>

        <div id="hiddenStats" class="hidden mt-20 scroll-mt-10">
            <div id="stats-content" class="preview-blur space-y-12">
                <div class="p-8 border border-indigo-100 rounded-[2rem] bg-white">
                    <p id="dynamicSummary" class="text-xl font-semibold text-slate-600 leading-relaxed"></p>
                </div>
                
                <div class="chart-section"><canvas id="projectionChart"></canvas></div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white p-12 rounded-[3rem] border border-slate-100 shadow-xl">
                        <p class="label-style text-slate-400">Final Net Worth</p>
                        <h3 class="text-5xl font-black text-slate-900 mt-2" id="resTotal">$0</h3>
                    </div>
                    <div class="bg-[#6366f1] p-12 rounded-[3rem] text-white shadow-2xl">
                        <p class="label-style text-white/70">Compound Interest Gift</p>
                        <h3 class="text-5xl font-black mt-2" id="resInterest">$0</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>Tools</h3>
                    <ul>
                        <li><a href="/index.html">Retirement Planner</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Legal</h3>
                    <ul>
                        <li><a href="/terms.html">Terms of Service</a></li>
                        <li><a href="/privacy.html">Privacy Policy</a></li>
                        <li><a href="/disclaimer.html">Disclaimer</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Contact</h3>
                    <ul>
                        <li><a href="/contact.html">Contact Us</a></li>
                        <li><a href="mailto:tom@better-investor.co">tom@better-investor.co</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2026 Tom - Lazy Investor. All rights reserved.</p>
                <p style="margin-top: 10px; font-size: 0.85rem;">This tool is for educational purposes only and does not constitute financial advice.</p>
            </div>
        </div>
    </footer>
</div>

<a href="#" id="sio-trigger" class="systeme-show-popup-22277060" style="display:none!important;">Trigger</a>
</body>
</html>
<script id="form-script-tag-22277060" src="https://go-tom.better-investor.co/public/remote/page/368079641e4b498d637ebbc4515679fde11122fd.js"></script>

<!-- Track Systeme.io Popup -->
<script>
(function() {
    let popupTracked = false;
    let formTracked = false;
    
    // Fonction pour tracker l'ouverture du popup
    function trackPopupOpen() {
        if (!popupTracked && typeof gtag !== 'undefined') {
            gtag('event', 'popup_opened', {
                'event_category': 'engagement',
                'event_label': 'Email Popup Opened'
            });
            popupTracked = true;
            console.log('‚úÖ GA4: Popup opened tracked');
        }
    }
    
    // Fonction pour d√©tecter si l'iframe est visible
    function checkIframeVisibility(iframe) {
        if (!iframe) return false;
        
        const rect = iframe.getBoundingClientRect();
        const style = window.getComputedStyle(iframe);
        
        // V√©rifie si l'iframe est visible (pas display:none, pas opacity:0, pas visibility:hidden)
        return rect.width > 0 && 
               rect.height > 0 && 
               style.display !== 'none' && 
               style.visibility !== 'hidden' && 
               parseFloat(style.opacity) > 0;
    }
    
    // Fonction pour surveiller l'iframe systeme.io
    function watchSystemeIframe() {
        const iframe = document.querySelector('iframe[id*="systemeio"]');
        
        if (iframe) {
            console.log('üîç Iframe systeme.io trouv√©, surveillance de la visibilit√©...');
            
            // Utiliser IntersectionObserver pour d√©tecter quand l'iframe devient visible
            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(function(entry) {
                    if (entry.isIntersecting && entry.intersectionRatio > 0) {
                        if (checkIframeVisibility(iframe)) {
                            trackPopupOpen();
                            observer.disconnect(); // Arr√™ter d'observer apr√®s le premier tracking
                        }
                    }
                });
            }, { threshold: 0.1 });
            
            observer.observe(iframe);
            
            // Backup: v√©rifier p√©riodiquement si l'iframe est visible
            let checkCount = 0;
            const visibilityChecker = setInterval(function() {
                checkCount++;
                if (checkIframeVisibility(iframe)) {
                    trackPopupOpen();
                    clearInterval(visibilityChecker);
                } else if (checkCount > 100) { // Arr√™ter apr√®s 50 secondes (100 * 500ms)
                    clearInterval(visibilityChecker);
                }
            }, 500);
            
            // Setup form submission tracking
            setupFormTracking(iframe);
        } else {
            // Si l'iframe n'existe pas encore, attendre qu'elle soit ajout√©e
            console.log('‚è≥ En attente de l\'iframe systeme.io...');
            setTimeout(watchSystemeIframe, 1000);
        }
    }
    
    // Fonction pour envoyer un √©v√©nement GA4 avec sendBeacon (survit aux redirections)
    function trackOptinWithBeacon() {
        if (formTracked) return;
        formTracked = true;
        
        // Utiliser sendBeacon pour garantir l'envoi m√™me pendant une redirection
        const measurementId = 'G-PRYY0KZ7HK';
        const apiSecret = 'YOUR_API_SECRET'; // Pas n√©cessaire pour les events simples
        
        // M√©thode 1: gtag avec transport: beacon
        if (typeof gtag !== 'undefined') {
            gtag('event', 'email_optin', {
                'event_category': 'conversion',
                'event_label': 'Email Opt-in Success',
                'transport_type': 'beacon'
            });
            console.log('üéâ GA4: Email opt-in tracked (with beacon)!');
        }
        
        // M√©thode 2 (backup): Envoyer directement via fetch keepalive
        fetch('https://www.google-analytics.com/g/collect?v=2&tid=' + measurementId + '&en=email_optin&_p=' + Math.random(), {
            method: 'POST',
            keepalive: true,
            headers: {'Content-Type': 'text/plain'},
            body: ''
        }).catch(function() {});
    }
    
    // Fonction pour tracker la soumission du formulaire
    function setupFormTracking(iframe) {
        console.log('üìã Setup form tracking...');
        
        let lastHeight = null;
        let heightChangeCount = 0;
        
        // 1. √âcouter TOUS les messages postMessage (pour debug et tracking)
        window.addEventListener('message', function(event) {
            // Filtrer les messages metamask (bruit)
            if (event.data && event.data.target === 'metamask-inpage') {
                return; // Ignorer metamask
            }
            
            console.log('üì® Message re√ßu de:', event.origin, '| Data:', event.data);
            
            // D√©tecter les messages de systeme.io avec dimensions
            if (event.origin && event.origin.includes('better-investor') && event.data && event.data.sender) {
                const data = event.data;
                
                // V√©rifier s'il y a des mots-cl√©s de succ√®s
                const dataStr = typeof data === 'string' ? data : JSON.stringify(data);
                if (dataStr && (dataStr.includes('success') || 
                     dataStr.includes('submitted') || 
                     dataStr.includes('subscribed') ||
                     dataStr.includes('confirmed') ||
                     dataStr.includes('thank'))) {
                    trackOptinWithBeacon();
                    return;
                }
                
                // Tracker les changements de hauteur significatifs
                if (data.height !== undefined) {
                    console.log('üìè Hauteur iframe:', data.height);
                    
                    if (lastHeight !== null) {
                        const heightDiff = Math.abs(data.height - lastHeight);
                        
                        // Si la hauteur change beaucoup (plus de 100px)
                        if (heightDiff > 100) {
                            heightChangeCount++;
                            console.log('üìê Changement de hauteur d√©tect√©:', lastHeight, '‚Üí', data.height);
                            
                            // Si l'iframe devient tr√®s petite (< 200px), c'est probablement ferm√©
                            if (data.height < 200 && lastHeight > 300) {
                                console.log('üéØ Popup probablement ferm√© apr√®s soumission');
                                setTimeout(function() {
                                    if (!formTracked) {
                                        trackOptinWithBeacon();
                                        console.log('üéâ Opt-in track√© (r√©duction hauteur)');
                                    }
                                }, 500);
                            }
                        }
                    }
                    
                    lastHeight = data.height;
                }
            }
        });
        
        // 2. D√©tecter quand l'iframe gagne puis perd le focus (= clic dedans)
        let iframeHadFocus = false;
        let lastInteractionTime = 0;
        
        window.addEventListener('blur', function() {
            // La fen√™tre perd le focus, peut-√™tre √† cause d'un clic dans l'iframe
            if (document.activeElement && document.activeElement.tagName === 'IFRAME') {
                iframeHadFocus = true;
                lastInteractionTime = Date.now();
                console.log('üëÜ Focus sur l\'iframe d√©tect√© (interaction probable)');
            }
        });
        
        window.addEventListener('focus', function() {
            // On reprend le focus, l'utilisateur a probablement interagi avec l'iframe
            if (iframeHadFocus) {
                lastInteractionTime = Date.now();
                console.log('üîÑ Focus revenu sur la page (apr√®s interaction iframe)');
            }
        });
        
        // 3. D√©tecter la navigation/redirection
        window.addEventListener('beforeunload', function(e) {
            // Si le popup √©tait ouvert ET qu'il y a eu une interaction r√©cente
            if (popupTracked && lastInteractionTime > 0 && Date.now() - lastInteractionTime < 5000) {
                trackOptinWithBeacon();
                console.log('üöÄ Redirection d√©tect√©e apr√®s interaction - tracking opt-in');
            } else if (popupTracked) {
                // M√™me sans interaction d√©tect√©e, si le popup √©tait ouvert, on track
                trackOptinWithBeacon();
                console.log('üöÄ Redirection d√©tect√©e avec popup ouvert - tracking opt-in (assumption)');
            }
        });
        
        // 4. D√©tecter si l'iframe change de taille ou dispara√Æt (signe de succ√®s)
        if (iframe) {
            const resizeObserver = new ResizeObserver(function(entries) {
                entries.forEach(function(entry) {
                    const height = entry.contentRect.height;
                    const width = entry.contentRect.width;
                    
                    // Si l'iframe devient tr√®s petite ou invisible
                    if ((height < 50 || width < 50) && popupTracked && !formTracked) {
                        console.log('üìè Iframe r√©duite/cach√©e - possiblement ferm√©e apr√®s soumission');
                        setTimeout(function() {
                            if (!formTracked) {
                                trackOptinWithBeacon();
                                console.log('üéâ Opt-in track√© (iframe r√©duite)');
                            }
                        }, 500);
                    }
                });
            });
            
            resizeObserver.observe(iframe);
        }
        
        // 5. Observer les changements de style/display de l'iframe
        if (iframe) {
            const styleObserver = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && 
                        (mutation.attributeName === 'style' || mutation.attributeName === 'class')) {
                        const style = window.getComputedStyle(iframe);
                        
                        // Si l'iframe dispara√Æt apr√®s avoir √©t√© visible
                        if ((style.display === 'none' || 
                             style.visibility === 'hidden' || 
                             parseFloat(style.opacity) < 0.1) && 
                            popupTracked && !formTracked) {
                            
                            console.log('üëª Iframe cach√©e - possiblement ferm√©e apr√®s soumission');
                            setTimeout(function() {
                                if (!formTracked) {
                                    trackOptinWithBeacon();
                                    console.log('üéâ Opt-in track√© (iframe cach√©e)');
                                }
                            }, 300);
                        }
                    }
                });
            });
            
            styleObserver.observe(iframe, { attributes: true });
        }
    }
    
    // D√©marrer la surveillance d√®s que le DOM est pr√™t
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', watchSystemeIframe);
    } else {
        watchSystemeIframe();
    }
    
    console.log('üëÄ GA4: Popup tracker initialized');
})();
</script>

<script>
    let myChart;
    const fmt = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });

    function initChart() {
        const ctx = document.getElementById('projectionChart').getContext('2d');
        if (myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'Wealth', data: [], borderColor: '#6366f1', backgroundColor: 'rgba(99, 102, 241, 0.1)', fill: true, tension: 0.4, pointRadius: 0 }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
        });
    }

    function startLoading() {
        // Track button click
        if (typeof gtag !== 'undefined') {
            gtag('event', 'calculate_retirement', {
                'event_category': 'engagement',
                'event_label': 'Generate My Retirement Path'
            });
        }
        
        const btn = document.getElementById('mainBtn');
        const btnText = document.getElementById('btnText');
        const resultsArea = document.getElementById('hiddenStats');
        
        btn.disabled = true;
        document.getElementById('btnSpinner').style.display = 'block';

        const logicSteps = [
            "Analyzing historical market data...",
            "Calculating compound interest...",
            "Adjusting for your annual additions...",
            "Simulating 1,000 market scenarios...",
            "Finalizing your wealth path..."
        ];

        let step = 0;
        const interval = setInterval(() => {
            if (step < logicSteps.length) {
                btnText.innerText = logicSteps[step];
                step++;
            } else {
                clearInterval(interval);
                finishLoading();
            }
        }, 700);

        function finishLoading() {
            btn.disabled = false;
            document.getElementById('btnSpinner').style.display = 'none';
            btnText.innerText = 'Generate My Retirement Path';
            
            calculateMagic();
            resultsArea.classList.remove('hidden');
            resultsArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            setTimeout(() => {
                const trigger = document.getElementById('sio-trigger');
                if (trigger) trigger.click();
            }, 400);
        }
    }

    function calculateMagic() {
        if (!myChart) initChart();
        const startAge = parseInt(document.getElementById('currentAge').value) || 30;
        const duration = parseInt(document.getElementById('duration').value) || 20;
        const rate = (parseFloat(document.getElementById('returnRate').value) || 8) / 100;
        const initial = parseFloat(document.getElementById('initialCapital').value) || 0;
        const addition = parseFloat(document.getElementById('annualAddition').value) || 0;
        
        let currentBal = initial;
        let currentPrin = initial;
        let points = [];
        let labels = [];

        for (let i = 0; i <= duration; i++) {
            points.push(currentBal);
            labels.push(new Date().getFullYear() + i);
            
            if (i < duration) {
                currentBal = (currentBal + addition) * (1 + rate);
                currentPrin += addition;
            }
        }
        
        document.getElementById('resTotal').innerText = fmt.format(currentBal);
        document.getElementById('resInterest').innerText = fmt.format(currentBal - currentPrin);
        document.getElementById('dynamicSummary').innerHTML = `In <span style="color:#6366f1;font-weight:800">${duration} years</span>, your portfolio grows to <span style="color:#6366f1;font-weight:800">${fmt.format(currentBal)}</span>. The market will have gifted you <span style="color:#6366f1;font-weight:800">${fmt.format(currentBal - currentPrin)}</span> in interest.`;
        
        myChart.data.labels = labels;
        myChart.data.datasets[0].data = points;
        myChart.update();
    }
    
    setTimeout(initChart, 500);
</script>
</head>
<body>
